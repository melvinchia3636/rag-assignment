<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.paint.Color?>
<?import javafx.scene.shape.Circle?>
<?import dev.assignment.view.SessionSidebar?>

<StackPane fx:id="root" prefHeight="600.0" prefWidth="900.0"
           xmlns="http://javafx.com/javafx/25"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="dev.assignment.controller.MainController"
           stylesheets="@main.css">

    <children>

        <VBox prefHeight="600.0" prefWidth="900.0">

            <children>

                <SplitPane dividerPositions="0.251" VBox.vgrow="ALWAYS">
                    <items>

                        <SessionSidebar fx:id="sessionSidebar"
                                        SplitPane.resizableWithParent="false" />

                        <VBox>
                            <children>

                                <!-- Top HBox: session labels, buttons, theme switch -->
                                <HBox alignment="CENTER" spacing="10" styleClass="top-hbox">
                                    <children>

                                        <VBox>
                                            <children>
                                                <Label fx:id="sessionNameLabel"
                                                    text="No Session Selected"
                                                    styleClass="label-session-name"/>
                                                <Label fx:id="sessionCreatedLabel"
                                                    text=""
                                                    styleClass="label-session-created"/>
                                            </children>
                                        </VBox>

                                        <Pane HBox.hgrow="ALWAYS"/>

                                        <Button fx:id="clearSessionButton"
                                                text="Clear Session"
                                                visible="false" managed="false"
                                                onAction="#handleClearSession"
                                                styleClass="button"/>

                                        <Button fx:id="manageKnowledgebaseButton"
                                                text="Manage Knowledgebase"
                                                visible="false" managed="false"
                                                onAction="#handleManageKnowledgebase"
                                                styleClass="button"/>

                                        <!-- Theme switch -->
                                        <ToggleButton fx:id="themeSwitch"
                                                    onAction="#handleThemeSwitch"
                                                    styleClass="theme-switch">
                                            <graphic>
                                                <StackPane styleClass="switch-background">
                                                    <Circle radius="8" styleClass="switch-thumb"/>
                                                </StackPane>
                                            </graphic>
                                        </ToggleButton>

                                    </children>
                                </HBox>

                                <!-- Chat scroll pane -->
                                <ScrollPane fx:id="chatScrollPane"
                                            fitToHeight="true" fitToWidth="true"
                                            hbarPolicy="NEVER"
                                            VBox.vgrow="ALWAYS">
                                    <content>
                                        <VBox fx:id="chatContainer"
                                            alignment="TOP_CENTER"
                                            spacing="6"/>
                                    </content>
                                </ScrollPane>

                                <!-- Message input -->
                                <HBox alignment="CENTER">
                                    <children>
                                        <TextArea fx:id="messageInput"
                                                promptText="Enter your prompt..."
                                                wrapText="true"
                                                HBox.hgrow="ALWAYS"
                                                styleClass="text-area-input"/>
                                        <Button fx:id="sendButton"
                                                text="Send"
                                                styleClass="button"
                                                onAction="#handleSendMessage"/>
                                    </children>
                                </HBox>

                            </children>
                        </VBox>


                    </items>
                </SplitPane>

                <HBox alignment="CENTER_LEFT" spacing="5">
                    <children>
                        <Label fx:id="statusLabel" text="Ready" HBox.hgrow="ALWAYS"/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Label fx:id="modelLabel" text="Model: GPT-4o-mini"/>
                    </children>
                </HBox>

            </children>
        </VBox>

        <Pane fx:id="loadingOverlay" visible="false" pickOnBounds="true">
            <children>
                <ProgressIndicator fx:id="loadingSpinner"
                                   prefWidth="60" prefHeight="60"
                                   visible="false"/>
            </children>
            <style>
                -fx-background-color: rgba(0,0,0,0.15);
            </style>
        </Pane>

    </children>
</StackPane>
